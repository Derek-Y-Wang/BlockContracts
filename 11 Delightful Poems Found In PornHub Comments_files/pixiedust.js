(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{kHJz:function(e,t,n){"use strict";n.r(t),n.d(t,"createInternalUnitTracking",(function(){return se})),n.d(t,"createExternalUnitTracking",(function(){return de})),n.d(t,"createSubbuzzImpressionTracking",(function(){return pe})),n.d(t,"impression",(function(){return ie})),n.d(t,"pageview",(function(){return re})),n.d(t,"webScroll",(function(){return D})),n.d(t,"contentClientLayer",(function(){return W})),n.d(t,"webContentLayer",(function(){return G})),n.d(t,"webClientLayer",(function(){return q})),n.d(t,"dataInternalLayer",(function(){return X})),n.d(t,"dataExternalLayer",(function(){return Y})),n.d(t,"dataSourceLayer",(function(){return F})),n.d(t,"createPixiedustBroadcaster",(function(){return m})),n.d(t,"internalClick",(function(){return oe})),n.d(t,"externalClick",(function(){return ae})),n.d(t,"createWebEvent",(function(){return te}));var r=n("zygG"),i=n("zjfJ"),o=10,a=200;function u(e){var t,n=e.debug,r=e.trackingURL,i=[],u=function(){if(i.length){var e=JSON.stringify(i);if(n)window.fetch("".concat(r,"/events"),{method:"POST",body:e,keepalive:!0}).then((function(e){return e.json()})).then((function(e){e.errors&&e.debug&&(console.group("%c \ud83d\udea8Pixiedust events rejected \ud83d\udea8","background-color: #250201; color: #ee8783; border: 1px solid #540b06"),e.debug.forEach((function(e){return console.table(e.validation)})),console.groupEnd())}));else!navigator.sendBeacon("".concat(r,"/events"),e)&&window.raven&&Math.random()<.1&&window.raven.captureException("Pixiedust: sendBeacon could not process a queue.");clearTimeout(t),t=null,i=[]}};return[function(e){i.push(e),i.length===o&&u(),t||(t=setTimeout(u,a))},u]}var c=n("VtSi"),s=n.n(c),d=n("fGyu"),p="\v",f=2e3,l=200;function _(e){var t=e.trackingURL,n=[],r=null;function i(){var e=Object(d.a)(n.reduce((function(e,t){return Object.keys(t).forEach((function(t){return e.add(t)})),e}),new Set)).reduce((function(e,t){return e[t]=n.map((function(e){return e[t]})),e}),{});e._z=Date.now(),e._d=p,e._n=n.length;var r=Object.keys(e).map((function(t){var n=e[t];return n=Array.isArray(n)?n:[n],encodeURIComponent(t)+"="+encodeURIComponent(n.join(p))}));return t+"/v1.gif?"+r.join("&")}var o=function(){n.length&&((new Image).src=i()),n=[],clearTimeout(r),r=null};return[function e(t){var a;return s.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(!(a=n[n.length-1])||a.type===t.type){u.next=5;break}return o(),e(t),u.abrupt("return");case 5:if(n.push(t),!(i().length>f)){u.next=12;break}return n.pop(),o(),e(t),u.abrupt("return");case 12:r||(r=setTimeout(o,l));case 13:case"end":return u.stop()}}),null,null,null,Promise)},o]}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g={dev:{trackingURL:"https://nsq-api-public.dev.buzzfeed.io",debug:!0},test:{trackingURL:"https://nsq-api-public.dev.buzzfeed.io",debug:!0},stage:{trackingURL:"https://pixiedust-stage.buzzfeed.com",debug:!0},prod:{trackingURL:"https://pixiedust.buzzfeed.com",debug:!1},"app-west":{trackingURL:"https://pixiedust.buzzfeed.com",debug:!1}},y=["type","event_type","source"];function m(){var e=v({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),t=navigator.sendBeacon?u:_,n=function(e,t){return v({},e.reduce((function(e,n){return v({},e,Object(i.a)({},n,t[n]))}),{}),{},t)},o=t(g[e.env]||g.dev),a=Object(r.a)(o,2),c=a[0],s=a[1];return[function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.flush,i=void 0!==r&&r;c(n(y,e)),i&&s()},function(n){if(n){var i=n.env;if(i&&i!==e.env){var o=t(g[i]),a=Object(r.a)(o,2);c=a[0],s=a[1]}e=v({},e,{},n)}return v({},e)}]}var w=n("YzYP"),h=n("BmUA"),O=n.n(h),j=n("hSXu"),x=n("/nJV"),k=n("8o0J"),z=O()((function(e){var t,n=e.destination,r=e.platform;return O()((function(e){var i,o,a;return s.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return i=e.env,t||(t=new k.a({env:i,namespace:"bf-xdomain-tracking",cookieName:"bf-xdomain-session-uuid",daysExpiry:.5/24,throttleTimer:18e4})),u.next=4,s.a.awrap(t.get());case 4:if(u.t0=u.sent,u.t0){u.next=7;break}u.t0=Object(x.a)();case 7:return o=u.t0,t.set(o),u.next=11,s.a.awrap(Object(j.a)({env:i}));case 11:return a=u.sent,u.abrupt("return",{client_id:a,client_uuid:String(a),destination:n,mode:window.matchMedia("screen and (max-width:51.9rem)").matches?"mobile":"desktop",os:"undefined"===typeof navigator?"Unknown":-1!==navigator.appVersion.indexOf("Win")?"Windows":-1!==navigator.appVersion.indexOf("Mac")?"MacOs":-1!==navigator.appVersion.indexOf("X11")?"Unix":-1!==navigator.appVersion.indexOf("Linux")?"Linux":"Unknown",platform:r,referrer_url:document.referrer,session_id:Date.now().toString(32)+(1e8*Math.random()|0).toString(32),viewport_size:JSON.stringify({width:window.screen.width,height:window.screen.height}),visit_id:o});case 13:case"end":return u.stop()}}),null,null,null,Promise)}),{normalizer:function(e){return JSON.stringify(e[0])}})}),{normalizer:function(e){return JSON.stringify(e[0])}}),S=function(e){var t=e.event_type,n=e.type,r=void 0===n?"web_".concat(t):n;return function(){return{type:r,event_type:t,client_ts:Date.now(),event_ts:Math.round(Date.now()/1e3),uuid:Object(x.a)()}}},P=m(),U=Object(r.a)(P,2),L=U[0],E=U[1],N=function(e){for(var t=e.event_type,n=e.type,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];var a=Object(w.c)(),u=Object(w.a)({layers:a(z({destination:"buzzfeed",platform:"web"}),S({event_type:t,type:n})),broadcast:function(e){L.apply(void 0,[e].concat(i))},context:E});return[u,a]},D=function(){return N({event_type:"scroll"},{flush:!0})},R=n("xwdf"),T=n("eoMO"),C=n("p5SE");function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M,I=function(){var e=Object(x.a)(),t=C.a.get("pdv3-previous_page_session_id")||"";return C.a.set({key:"pdv3-previous_page_session_id",value:e,expires:18e5}),{page_session_id:e,previous_page_session_id:t}},V=O()((function(e){var t;return O()((function(e){var n,i,o,a,u;return s.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return n=e.env,t||(t=new k.a({env:n,namespace:"bf-xdomain-tracking",cookieName:"bf-xdomain-session-uuid",daysExpiry:.5/24,throttleTimer:18e4})),c.next=4,s.a.awrap(Promise.all([Object(j.a)({env:n,legacy:!1}),t.get()]));case 4:return i=c.sent,o=Object(r.a)(i,2),a=o[0],u=o[1],a=String(a),u=u&&"null"!==u?u:Object(x.a)(),t.set(u),c.abrupt("return",A({client_uuid:a,client_session_id:u},I()));case 12:case"end":return c.stop()}}),null,null,null,Promise)}),{normalizer:function(e){return JSON.stringify(e[0])}})}),{max:1,normalizer:function(e){return JSON.stringify(e[0])}}),B=function(){return function(){return{event_ts:Math.round(Date.now()/1e3),event_uuid:Object(x.a)()}}},q=function(){return function(){return{event_uri:document.location.href,referrer_uri:document.referrer,mode:window.matchMedia("screen and (max-width:51.9rem)").matches?"mobile":"desktop",viewport_size:{width:window.screen.width,height:window.screen.height}}}},W=function(e){var t=e.destination,n=void 0===t?"buzzfeed":t,r=e.context_page_id,i=e.context_page_type,o=e.page_edition;return function(){return{destination:n,context_page_id:String(r),context_page_type:i,page_edition:o}}},G=function(e){return function(){return{data_source_name:decodeURIComponent(e.data_source_name)||"",item_name:String(e.item_name),item_type:e.item_type,position_in_subunit:isNaN(Number(e.position_in_subunit))?null:Number(e.position_in_subunit),position_in_unit:isNaN(Number(e.position_in_unit))?null:Number(e.position_in_unit),subunit_type:e.subunit_type||"",subunit_name:e.subunit_name||"",unit_name:e.unit_name,unit_type:e.unit_type}}},X=function(e){var t=e.item_name,n=e.target_content_id,r=e.target_content_type;return function(){return{target_content_id:String(n||t),target_content_type:r}}},Y=function(e){var t=e.target_content_url;return function(){return{target_content_url:t}}},H=function(e){return e.map((function(e){return"undefined"===e?"":e}))},F=function(e){return function(){return{data_source_name:e.data_source_name?decodeURIComponent(e.data_source_name):"",data_source_algorithm:e.data_source_algorithm&&Array.isArray(e.data_source_algorithm)?H(e.data_source_algorithm):[],data_source_algorithm_version:e.data_source_algorithm_version&&Array.isArray(e.data_source_algorithm_version)?H(e.data_source_algorithm_version):[]}}},K=function(e){for(var t=e.broadcast,n=e.context,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];var a=Object(T.b)(),u=function(){return"undefined"!==typeof document?document.location.href:""},c=Object(T.a)({layers:a(B(),V(u()),q()),broadcast:function(e){t.apply(void 0,[e].concat(i))},context:n});return[c,a]},Q=m(),Z=Object(r.a)(Q,2),$=Z[0],ee=Z[1],te=function(e){for(var t=e.type,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var a=K.apply(void 0,[{broadcast:$,context:ee}].concat(i)),u=Object(r.a)(a,2),c=u[0],s=u[1];return s({type:t,source:"web_bf"},{random_user_uuid:R.a.get("user_uuid")||"unauthenticated"}),[c,s]},ne=function(e){var t=e.type,n=e.click_type,i=te({type:t},{flush:!0}),o=Object(r.a)(i,2),a=o[0],u=o[1];return u({click_type:n}),[a,u]},re=function(){return te({type:"web_pageview"})},ie=function(){return te({type:"web_impression"})},oe=function(){return ne({type:"web_internal_link",click_type:"left"})},ae=function(){return ne({type:"web_external_link",click_type:"left"})},ue=n("C/ug"),ce=n("v0uu");M=ce.CLUSTER,E({env:M}),function(e){ee({env:e})}(ce.CLUSTER);var se=function(){return Object(ue.b)(ie(),oe(),ne({type:"web_internal_link",click_type:"right"}))},de=function(){return Object(ue.b)(ie(),ae(),ne({type:"web_external_link",click_type:"right"}))},pe=function(){return Object(ue.a)(te({type:"web_subbuzz_impression"}),{threshold:.01,visibilityTime:100})}}}]);
//# sourceMappingURL=pixiedust.4da5f1c3da934f918e12.js.map